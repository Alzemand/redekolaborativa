{{extend 'layout_rede.html'}}
{{if project != message:}}

<!-- Espaço apresentação do Usuário -->




<td>
{{if auth.user_id == project.project_owner:}}
    <a class="btn" href="{{=URL('edit_project', args=request.args(0))}}">{{=T("Edit project")}}</a><br><br>
{{pass}}
</td>


<section class="row span_12 f-left">
    <section class="f-left span_8 col apresenta-user">

    <img src="{{=URL('static','images/Edit_perfil/barra_editar_perfil.png')}}" title="" class="w-full f-left barra-colorida">    
    <!-- Apresentação do usuário -->
    <section class="f-left span_4 col">

        <a class="btn" href="{{=URL('edit_project', args=request.args(0))}}">
          <img src={{=URL('static', '/images/editBlack.png')}} class="edit">
        </a>

        <!-- Foto de perfil -->
        <figure class="foto-perfil">
          {{if project.image:}}
              <img src={{=URL('download', args=project.image)}} width="168px" height="168px">
          {{else:}}
              <img src={{=URL('static', 'images/non_project.png')}} width="168px" height="168px">
          {{pass}}
        </figure>
       
    </section>


    <!-- Bio usuário -->
    <section class="f-left span_7  col descricao">
        <p>
            <h1>{{=project.name}}</h1>
            <br>
            
            {{=g_return_if_empty(project.short_description)}}
        </p>
        
        <b>Site do Projeto: <a href="#">www.google.com</a></b>
        
    </section>
    <!-- Barra abaixo -->
    <section class="f-left span_12  col redes_sociais">
        <section class="f-left w-full">
            <h2 class="f-left">SIGA-ME:</h2>
            
            <!-- Aqui vai os links -->
        </section>
    </section>

</section>
<!-- Informações pessoais -->
<section class="f-left span_4 col bloco_info info_basica">
    <h2 class="title">{{=T("Personal Info")}}</h2>
    <ul>
        <li>
          <a href="/{{=project.project_owner.username}}">
            <span class="h2">
                {{=T("Owner")}}: {{=project.project_owner.username}}
            </span>
          </a>
        </li>
        <li>
          <span class="h2">
             {{=T("Phone")}}: {{=g_return_if_empty(project.phone)}}
          </span>
        </li>
        <li>
          <span class="h2">
           Tipo: {{=g_return_if_empty(project.project_type)}} <br>
           </span>
        </li>
        <li>
          <span class="h2">
            {{=T("Email")}}: {{=g_return_if_empty(project.project_mail)}}
          </span>
        </li>
    </ul>
</section>
</section>
<style>

</style>
<section class="row span_12 f-left">
  <section class="col span_4 f-left proj_col">
          <!-- Video do projeto -->
          <section class="f-left span_12 col bloco_info video">
           <h2 class="title">{{=T("Video")}}</h2>
           {{if project.video_url:}}
           <iframe class="youtube" src="{{=project.video_url}}" frameborder="0" allowfullscreen></iframe>
           {{pass}}
         </section>
         <!-- Projetos que eu colaboro -->
         <section class="f-left span_12 col bloco_info slideshare">
           <h2 class="title">Slideshare</h2>
           {{if project.slideshare_url:}}
           
           <iframe src="{{=project.slideshare_url}}" class="slides" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe>
           {{pass}}
         </section> 
         <!-- Procurando por -->
         <section class="f-left span_12 col bloco_info procura_membros">
           <h2 class="title">Procurando por</h2>
           <ul>
           <!-- Procurando profissões \/ -->
           {{if project.wanting_team:}}
           <li>
             <b>{{=T("We need some more members...")}}</b>
           </li>
               {{if project.team_wanted:}}
                   {{if len(project.team_wanted) >= 1:}}
                         <li>
                           {{=project.team_wanted}}
                         </li>
                   {{pass}}
              {{pass}}
           {{pass}}

           <!-- Procurando outros \/ -->
           {{if project.wanting_other:}}
            <li>
              <b>{{=T("We are looking for other kinds of help...")}}</b>
            </li>
             {{if project.other_wanted:}}
               {{if len(project.other_wanted) >= 1:}}
                  <li>{{=project.other_wanted}}</li>
               {{pass}}
             {{pass}}
           {{pass}}
          </ul>
         </section> 
         <!-- Links do projet -->
         <section class="f-left span_12 col bloco_info link">
          <h2 class="title">{{=T("Links")}}:</h2>
          {{if project.project_links:}}
          {{for i in project.project_links:}}
          {{if i == project.project_links[-1]:}}
          <a href="{{=i}}" target="_blank">Link {{=project.project_links.index(i) + 1}}</a><br>
          {{else:}}
          <a href="{{=i}}" target="_blank">Link {{=project.project_links.index(i) + 1}}</a> |
          {{pass}}
          {{pass}}
          {{else:}}
          {{=T("Undefined")}}<br>
          {{pass}}
        </section>

         <!--  <section class="f-left span_12 col bloco_info info_profissional">
            <a class="btn btn_team">{{=T("Searching for members?")}}</a>
            {{=searching_team}}
          </section>
        -->
    </section>
    <style>
  
  </style>      

  <section class="col span_8 f-left proj_col">
      <!-- Meus projetos -->
      <section class="f-left span_12 col bloco_info desc_completa">
             <h2 class="title">Descrição completa</h2>
            <p>
            {{=g_return_if_empty(project.description)}}
            </p>
      </section>
      <style>
           
      </style>
      <section class="f-left span_12 col bloco_info equipe">
           <h2 class="title f-left">Membros</h2>
           <div class="title f-left search-equipe">
                 {{ if auth.user and auth.user.id == project.project_owner:}}
                    {{=new_colaborator}}
                {{ pass }}
           </div>

           <!-- Espaço de mostragem de membros -->

          {{for collaborator in collaborators:}}
             <div class="membro-equipe f-left">
               <a href="/{{=collaborator.username}}" class="pull-left">
                 {{if not collaborator.avatar:}}
                   <img src="{{=URL('static', 'images/non_avatar.gif')}}" alt="{{=collaborator.username}}" class="avatar-membro">
                {{else:}}
                   <img src="{{=URL('download', args=collaborator.avatar)}}" alt="{{=collaborator.username}}" class="avatar-membro">
                 {{pass}}
               </a>
               <div class="membro-descricao">
               <!-- Nome do membro -->
                <span class="bold">{{=g_return_if_empty(collaborator.username)}}</span>
                <!-- Botões de sair do projeto ou remover o membro -->
                <!-- 
                {{# if auth.user and collaborator.id == auth.user.id: }}
                <a href="{{=URL(c='default', f='remove_person', vars={'user_id':collaborator.id, 'project_id': project.id})}}">
                  <button class="btn btn-small btn-danger">Sair</button>
                </a>
                {{# elif auth.user and project.project_owner == auth.user.id: }}
                <a href="{{=URL(c='default', f='remove_person', vars={'user_id':collaborator.id, 'project_id': project.id})}}">
                  <button class="btn btn-small btn-danger">Remover</button>
                </a>
                {{# pass }} -->


                <br>
                <!-- Profissão(ções) do membro -->
                <span class="italic">
                {{if hasattr(collaborator, 'professions'):}}
                  {{for job in collaborator.professions:}}
                    {{if job == collaborator.professions[-1]:}}
                      {{=job.profession}}<br>
                    {{else:}}
                      {{=job.profession}},
                    {{pass}}
                  {{pass}}
                {{else:}}
                  {{=T("Undefined")}}<br>
                {{pass}}
                </span>
                <!-- Cargo no time -->
                <span class="italic">
                {{=g_return_if_empty(collaborator.role)}}
                  {{if auth.user_id == project.project_owner:}}
                  <br>
                  {{=user_role.custom.begin}}
                  {{if collaborator.role:}}
                  <a class="btn btn_edit"><i class="icon-edit"></i></a>
                  {{else:}}
                  <a class="btn btn_plus"><i class="icon-plus-sign"></i></a>
                  {{pass}}
                </span>
                <!-- Perguntar para o tchu tchu o que faz !  -->
                {{user_role.elements(_type="submit")[0] ['_class']="btn btn_ok"}}
                {{=user_role.custom.submit}}
                {{user_role.elements("#no_table_username")[0] ['_type']="hidden"}}
                {{user_role.elements("#no_table_username")[0] ['_value']=collaborator.username}}
                {{=user_role.custom.widget.username}}<br>
                {{user_role.elements("#no_table_role")[0] ['_placeholder']=T("Define role")}}
                {{user_role.elements("#no_table_role")[0] ['_name']="role"}}
                {{user_role.elements("#no_table_role")[0] ['_class']="field_role"}}
                {{=user_role.custom.widget.role}}<br>
                {{=user_role.custom.end}}
                {{pass}}
                    <!-- """
                    Se for o dono do projeto, adicionar campo para adicionar uma pessoa no projeto.
                    """ -->
            </div>
          </div>
          {{pass}}
      
      </section>
      <section class="f-left span_12 col bloco_info comentarios">
           <h2 class="title">{{=T('Comments')}}</h2>
           <div class="comentarios">
          {{#=LOAD('default','comments.load',ajax=True)}}
          </div>
      </section>
  </section>
</section>
    
{{pass}}



<script src={{=URL('static', 'js/select2.min.js')}}></script>
<link href={{=URL('static', 'css/select2.css')}} rel="stylesheet">

<script>
jQuery(document).ready(function(){
   $('.field_role').hide();
   $('.btn_ok').hide();
   $('#searching_team').hide();

   jQuery(".btn_plus").on("click", function(){
      var form = $(this).closest("#user_role");
      form.find(".field_role").toggle();
      form.find(".btn_ok").toggle();
      });
   jQuery(".btn_edit").on("click", function(){
      var form = $(this).closest("#user_role");
      form.find(".field_role").toggle();
      form.find(".btn_ok").toggle();
      });
   jQuery(".btn_team").on("click", function(){
      $(this).closest('td').find("#searching_team").toggle();
   })

   jQuery('.btn_team').on("click", function(){
        if(jQuery('#projects_wanting_team').attr('checked'))
            jQuery('#projects_team_wanted__row').show();
        else jQuery('#projects_team_wanted__row').hide();

        if(jQuery('#projects_wanting_other').attr('checked'))
            jQuery('#projects_other_wanted__row').show();
        else jQuery('#projects_other_wanted__row').hide();});

   jQuery('#projects_wanting_team').change(function(){
        if(jQuery('#projects_wanting_team').attr('checked'))
            jQuery('#projects_team_wanted__row').show();
        else jQuery('#projects_team_wanted__row').hide();});
   jQuery('#projects_wanting_other').change(function(){
        if(jQuery('#projects_wanting_other').attr('checked'))
            jQuery('#projects_other_wanted__row').show();
        else jQuery('#projects_other_wanted__row').hide();});
});


function MultiAjaxAutoComplete(element, url) {
    $(element).select2({
        placeholder: "{{=T('Search for a user')}}",
        minimumInputLength: 1,
        multiple: true,
        formatNoMatches: function(){return "{{=T('No results')}}"},
        formatSearching: function(){return "{{=T('Searching...')}}"},
        formatInputTooShort: function(){return "{{=T('Too short')}}"},

        id: function(e) { return e.id+":"+e.title; },
        ajax: {
            url: url,
            dataType: 'json',
            data: function(term, page) {

                return {
                    q: term,
                    page_limit: 10,
                };
            },
            results: function(data, page) {
                return {
                    results: data.users
                };
            }
        },
        formatResult: formatResult,
        formatSelection: formatSelection,
        initSelection: function(element, callback) {
            var data = [];
            $(element.val().split(",")).each(function(i) {
                var item = this.split(':');
                data.push({
                    id: item[0],
                    title: item[1]
                });
            });
            callback(data);
        }
    });
};

var url = "{{=URL(r=request,f='call',args=['json','get_user_name'])}}";

MultiAjaxAutoComplete('#no_table_team', url);

function formatResult(user) {
    return '<div>' + user.title + '</div>';
};

function formatSelection(data) {
    return data.title;
};

</script>
