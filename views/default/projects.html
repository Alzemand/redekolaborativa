{{extend 'layout.html'}}
{{if project != message:}}
<h1>{{=project.name}}</h1>
<table>
<tr>
<td width="40%">
<h3>{{=T("Project Info")}}</h3>
<b>{{=T("Name")}}:</b> {{=project.name}}<br>
<b>{{=T("Type")}}:</b> {{=g_return_if_empty(project.project_type)}}<br>
<b>{{=T("Owner")}}:</b> {{=project.project_owner.username}}<br>
<b>{{=T("Description")}}:</b> {{=g_return_if_empty(project.description)}}
</td>

<td width="40%">
<h3>{{=T("Contact Info")}}</h3>
<b>{{=T("Address")}}:</b> {{=g_return_if_empty(project.address)}} <br>
<b>{{=T("Phone")}}:</b> {{=g_return_if_empty(project.phone)}} <br>
<b>{{=T("Links")}}:</b>
      {{if project.project_links:}}
            {{for i in project.project_links:}}
                        {{if i == project.project_links[-1]:}}
                              <a href="{{=i}}">Link {{=project.project_links.index(i) + 1}}</a><br>
                        {{else:}}
                              <a href="{{=i}}">Link {{=project.project_links.index(i) + 1}}</a> |
                        {{pass}}
            {{pass}}
      {{else:}}
            {{=T("Undefined")}}
      {{pass}}
      <br>

<b>{{=T("Email")}}:</b> {{=g_return_if_empty(project.project_mail)}} <br>

{{if project.wanting_team:}}<b>{{=T("We need some more members...")}}</b> <br>{{pass}}
{{if project.team_wanted:}}
                        {{if len(project.team_wanted) >= 1:}}
                        {{=', '.join(project.team_wanted)}}<br>
                        {{pass}}
{{pass}}

{{if project.wanting_other:}}<b>{{=T("We are looking for other kinds of help...")}}</b> <br>{{pass}}
{{if project.other_wanted:}}
                        {{if len(project.other_wanted) >= 1:}}
                        {{=', '.join(project.other_wanted)}}<br>
                        {{pass}}
{{pass}}
</td>

<td>
{{if project.image:}}
<img src={{=URL('download', args=project.image)}} width="168px" height="168px">
{{else:}}
<img src={{=URL('static', 'images/non_project.png')}} width="168px" height="168px">
{{pass}}
</td>
</tr>

<tr>
<td>
<h3>{{=T("Who is Kolaborating")}}</h3>
{{for collaborator in collaborators:}}
	<div class="media">
	     <a href="/{{=collaborator.username}}" class="pull-left">
           {{if not collaborator.avatar:}}
      		<img src="{{=URL('static', 'images/non_avatar.gif')}}" alt="{{=collaborator.username}}" class="media-object" width="50px" height="50px">
            {{else:}}
                  <img src="{{=URL('download', args=collaborator.avatar)}}" alt="{{=collaborator.username}}" class="media-object" width="50px" height="50px">
            {{pass}}
      	</a>
      <div class="media-body">
      	<b>{{=T("Profession")}}:</b>
                  {{for job in professions:}}
                        {{if job:}}
                              {{if job.user_id == collaborator.id:}}
                                    {{if job == professions[-1]:}}
                                          {{=job.profession}}
                                    {{else:}}
                                          {{=job.profession}},
                                    {{pass}}
                              {{pass}}
                        {{else:}}
                  	      {{=T("Undefined")}}
                        {{pass}}<br>
                  {{pass}}

            <b>{{=T("Role")}}:</b>
                  {{for this_function in user_function:}}
                        {{if this_function:}}
                              {{if this_function.username == collaborator.username:}}
                                    {{=this_function.role}}
                              {{pass}}
                        {{else:}}
                              {{=T("Undefined")}}<br>
                  	{{pass}}
                  {{pass}}<br>

            {{if auth.user_id == project.project_owner:}}
                  {{=user_role.custom.begin}}
                  {{for this_function in user_function:}}
                        {{if this_function:}}
                              {{if not this_function.username == collaborator.username:}}
                                    <a class="btn btn_plus"><i class="icon-plus-sign"></i></a>
                              {{else:}}
                                    <a class="btn btn-edit"><i class="icon-edit"></i></a>
                              {{pass}}
                        {{pass}}
                  {{pass}}
                  {{user_role.elements(_type="submit")[0] ['_class']="btn btn_ok"}}
                  {{=user_role.custom.submit}}
                  {{user_role.elements("#no_table_username")[0] ['_type']="hidden"}}
                  {{user_role.elements("#no_table_username")[0] ['_value']=collaborator.username}}
                  {{=user_role.custom.widget.username}}<br>
                  {{user_role.elements("#no_table_role")[0] ['_placeholder']=T("Define role")}}
                  {{user_role.elements("#no_table_role")[0] ['_name']="role"}}
                  {{user_role.elements("#no_table_role")[0] ['_class']="field_role"}}
                  {{=user_role.custom.widget.role}}<br>
                  {{=user_role.custom.end}}
            {{pass}}
      </div>
  	</div>

{{pass}}
</ul>
</td>
</tr>
</table>
{{else:}}
{{=project}}
{{pass}}

<script>
jQuery(document).ready(function(){
   $('.field_role').hide();
   $('.btn_ok').hide();
   jQuery(".btn_plus").on("click", function(){
      var form = $(this).closest("#user_role");
      form.find(".field_role").show();
      form.find(".btn_ok").show();
      });
   jQuery(".btn-edit").on("click", function(){
      var form = $(this).closest("#user_role");
      form.find(".field_role").show();
      form.find(".btn_ok").show();
      });
});
</script>